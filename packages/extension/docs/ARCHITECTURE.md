# ะััะธัะตะบัััะฐ ัะฐััะธัะตะฝะธั LiveScribe

ะัะพััะพะต ะธ ะฟะพะฝััะฝะพะต ะพะฑัััะฝะตะฝะธะต ัะพะณะพ, ะบะฐะบ ัะฐะฑะพัะฐะตั Chrome ัะฐััะธัะตะฝะธะต LiveScribe ะดะปั ััะฐะฝัะบัะธะฑะฐัะธะธ ะฒะธะดะตะพะทะฒะพะฝะบะพะฒ.

## ะกะพะดะตัะถะฐะฝะธะต
- [ะะฑัะฐั ััะตะผะฐ](#ะพะฑัะฐั-ััะตะผะฐ)
- [ะะพะผะฟะพะฝะตะฝัั ัะฐััะธัะตะฝะธั](#ะบะพะผะฟะพะฝะตะฝัั-ัะฐััะธัะตะฝะธั)
- [ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั](#ะบะฐะบ-ััะพ-ัะฐะฑะพัะฐะตั)
- [ะะพัะพะบ ะดะฐะฝะฝัั](#ะฟะพัะพะบ-ะดะฐะฝะฝัั)
- [ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ](#ัะตัะฝะธัะตัะบะธะต-ะดะตัะฐะปะธ)

---

## ะะฑัะฐั ััะตะผะฐ

LiveScribe - ััะพ Chrome ัะฐััะธัะตะฝะธะต, ะบะพัะพัะพะต:
1. **ะะฐัะฒะฐััะฒะฐะตั ะฐัะดะธะพ** ะธะท ะฒะบะปะฐะดะบะธ ะฑัะฐัะทะตัะฐ (ะฒะธะดะตะพะทะฒะพะฝะพะบ, YouTube ะธ ั.ะด.)
2. **ะัะฟัะฐะฒะปัะตั ะฐัะดะธะพ** ะฝะฐ ะฑัะบะตะฝะด-ัะตัะฒะตั ะดะปั ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั ัะตัะธ
3. **ะะพะปััะฐะตั ััะฐะฝัะบัะธะฟัะธะธ** ะพะฑัะฐัะฝะพ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
4. **ะะพะบะฐะทัะฒะฐะตั ัะตะบัั** ะฒ ะฒะธะดะถะตัะต ะฟััะผะพ ะฝะฐ ัััะฐะฝะธัะต

**ะะฐะถะฝะพ:** ะะพะปัะทะพะฒะฐัะตะปั **ัะปััะธั ะทะฒัะบ** ะฒะพ ะฒัะตะผั ะทะฐะฟะธัะธ! ะะฐััะธัะตะฝะธะต ัะพะปัะบะพ "ะฟะพะดัะปััะธะฒะฐะตั" ะฐัะดะธะพ, ะฝะต ะฟะตัะตัะฒะฐััะฒะฐั ะตะณะพ.

---

## ะะพะผะฟะพะฝะตะฝัั ัะฐััะธัะตะฝะธั

ะะฐััะธัะตะฝะธะต ัะพััะพะธั ะธะท 3 ะพัะฝะพะฒะฝัั ัะฐััะตะน, ะบะฐะถะดะฐั ัะพ ัะฒะพะตะน ัะพะปัั:

### 1. Content Script (`src/content/content.ts`)
**ะงัะพ ััะพ:** JavaScript ะบะพะด, ะบะพัะพััะน ะทะฐะฟััะบะฐะตััั **ะฝะฐ ะบะฐะถะดะพะน ะพัะบัััะพะน ัััะฐะฝะธัะต** ะฑัะฐัะทะตัะฐ.

**ะงัะพ ะดะตะปะฐะตั:**
- ๐จ ะะธััะตั **ะฒะธะดะถะตั** (ะฟะปะฐะฒะฐััะตะต ะพะบะพัะบะพ) ะฝะฐ ัััะฐะฝะธัะต
- ๐ฑ๏ธ ะะฑัะฐะฑะฐััะฒะฐะตั ะบะปะธะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐ ะบะฝะพะฟะบะธ Start/Stop
- ๐ **ะะพะบะฐะทัะฒะฐะตั ััะฐะฝัะบัะธะฟัะธะธ** ะฒ ะฒะธะดะถะตัะต ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ๐ฌ ะะฑัะฐะตััั ั Service Worker ัะตัะตะท ัะพะพะฑัะตะฝะธั

**ะัะพัััะผะธ ัะปะพะฒะฐะผะธ:** ะญัะพ UI ัะฐััะธัะตะฝะธั - ัะพ, ััะพ ะฒะธะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั.

---

### 2. Service Worker (`src/background/service-worker.ts`)
**ะงัะพ ััะพ:** ะคะพะฝะพะฒัะน ัะบัะธะฟั, ะบะพัะพััะน ัะฐะฑะพัะฐะตั **ะฟะพััะพัะฝะฝะพ** (ะดะฐะถะต ะบะพะณะดะฐ ัััะฐะฝะธัั ะทะฐะบัััั).

**ะงัะพ ะดะตะปะฐะตั:**
- ๐๏ธ **ะะพะพัะดะธะฝะธััะตั** ัะฐะฑะพัั ะผะตะถะดั Content Script ะธ Offscreen Document
- ๐จ **ะะตัะตััะปะฐะตั ัะพะพะฑัะตะฝะธั** ะผะตะถะดั ะบะพะผะฟะพะฝะตะฝัะฐะผะธ
- ๐ ะฃะฟัะฐะฒะปัะตั ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ Offscreen Document
- ๐ ะฅัะฐะฝะธั ัะพััะพัะฝะธะต ะทะฐะฟะธัะธ (idle/recording)

**ะัะพัััะผะธ ัะปะพะฒะฐะผะธ:** ะญัะพ "ะผะพะทะณ" ัะฐััะธัะตะฝะธั - ะบะพะพัะดะธะฝะฐัะพั ะฒัะตั ะฟัะพัะตััะพะฒ.

---

### 3. Offscreen Document (`src/offscreen/offscreen.ts`)
**ะงัะพ ััะพ:** ะะตะฒะธะดะธะผะฐั ัััะฐะฝะธัะฐ, ะบะพัะพัะฐั ัะฐะฑะพัะฐะตั **ะฒ ัะพะฝะต**.

**ะงัะพ ะดะตะปะฐะตั:**
- ๐ค **ะะฐัะฒะฐััะฒะฐะตั ะฐัะดะธะพ** ัะตัะตะท chrome.tabCapture API
- ๐ **ะะพัะฟัะพะธะทะฒะพะดะธั ะฐัะดะธะพ** ัะตัะตะท Audio element (ััะพะฑั ะฟะพะปัะทะพะฒะฐัะตะปั ัะปััะฐะป)
- ๐ต **ะะฑัะฐะฑะฐััะฒะฐะตั ะฐัะดะธะพ** ัะตัะตะท AudioWorklet (ะบะพะฝะฒะตััะธััะตั ะฒ PCM ัะพัะผะฐั)
- ๐ **ะะพะดะบะปััะฐะตััั ะบ WebSocket** ะธ ะพัะฟัะฐะฒะปัะตั ะฐัะดะธะพ ะฝะฐ ะฑัะบะตะฝะด
- ๐ฅ **ะะพะปััะฐะตั ััะฐะฝัะบัะธะฟัะธะธ** ะพั ะฑัะบะตะฝะดะฐ ะธ ะฟะตัะตััะปะฐะตั ะฒ Service Worker

**ะัะพัััะผะธ ัะปะพะฒะฐะผะธ:** ะญัะพ "ัะฐะฑะพัะฝะธะบ" - ะดะตะปะฐะตั ะฒัั ััะถัะปัั ัะฐะฑะพัั ะฟะพ ะพะฑัะฐะฑะพัะบะต ะฐัะดะธะพ.

---

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะจะฐะณ 1: ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั Start

```
1. ะะพะปัะทะพะฒะฐัะตะปั ะบะปะธะบะฐะตั "Start" ะฒ ะฒะธะดะถะตัะต
2. Content Script ะพัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต "START_RECORDING" ะฒ Service Worker
3. Service Worker ะฟะพะปััะฐะตั ัะพะพะฑัะตะฝะธะต
```

### ะจะฐะณ 2: ะะฐะฟััะบ ะทะฐะฟะธัะธ

```
4. Service Worker ัะพะทะดะฐัั Offscreen Document (ะตัะปะธ ะตะณะพ ะฝะตั)
5. Service Worker ะฒัะทัะฒะฐะตั chrome.tabCapture.getMediaStreamId()
   โ ะะพะปััะฐะตั ID ะฟะพัะพะบะฐ ะฐัะดะธะพ ะธะท ัะตะบััะตะน ะฒะบะปะฐะดะบะธ
6. Service Worker ะพัะฟัะฐะฒะปัะตั streamId ะฒ Offscreen Document
```

**ะงัะพ ะฟัะพะธััะพะดะธั ะฒ ะฑัะฐัะทะตัะต:**
- ะ ะฒะบะปะฐะดะบะต ะฟะพัะฒะปัะตััั ๐ต ัะธะฝะธะน ะบะฒะฐะดัะฐั ั ัะตะบััะพะผ "Tab's content is being shared"
- ะญัะพ ะฝะพัะผะฐะปัะฝะพ! ะญัะพ ะธะฝะดะธะบะฐัะพั chrome.tabCapture

### ะจะฐะณ 3: Offscreen ะพะฑัะฐะฑะฐััะฒะฐะตั ะฐัะดะธะพ

```
7. Offscreen Document ะฟะพะปััะฐะตั streamId
8. ะกะพะทะดะฐัั MediaStream ะธะท streamId
9. ะกะพะทะดะฐัั ะดะฒะฐ ะฟััะธ ะดะปั ะฐัะดะธะพ:

   โโโโโโโโโโโโโโโโ MediaStream โโโโโโโโโโโโโโโโ
   โ                                            โ
   โ                                            โ
[Audio Element]                      [AudioWorklet]
   โ                                            โ
   โ                                            โ
ะะพัะฟัะพะธะทะฒะตะดะตะฝะธะต                           ะะฑัะฐะฑะพัะบะฐ
(ะฟะพะปัะทะพะฒะฐัะตะปั ัะปััะธั)              (ะบะพะฝะฒะตััะฐัะธั ะฒ PCM)
```

**ะะพะดัะพะฑะฝะตะต:**

**ะััั 1 - ะะพัะฟัะพะธะทะฒะตะดะตะฝะธะต:**
```javascript
const audioElement = new Audio();
audioElement.srcObject = mediaStream;
audioElement.play();
```
โ ะะพะปัะทะพะฒะฐัะตะปั ัะปััะธั ะทะฒัะบ!

**ะััั 2 - ะะฑัะฐะฑะพัะบะฐ:**
```javascript
sourceNode = audioContext.createMediaStreamSource(mediaStream);
workletNode = new AudioWorkletNode(audioContext, 'audio-processor');
sourceNode.connect(workletNode);
```
โ ะัะดะธะพ ะพะฑัะฐะฑะฐััะฒะฐะตััั ะดะปั ััะฐะฝัะบัะธะฑะฐัะธะธ

### ะจะฐะณ 4: ะัะฟัะฐะฒะบะฐ ะฝะฐ ะฑัะบะตะฝะด

```
10. AudioWorklet ะบะพะฝะฒะตััะธััะตั ะฐัะดะธะพ ะฒ PCM ัะพัะผะฐั (Int16, 16000 Hz)
11. Offscreen ะพัะฟัะฐะฒะปัะตั ะฐัะดะธะพ ัะฐะฝะบะธ ะฟะพ WebSocket:
    {
      type: "audio",
      sessionId: "...",
      sampleRate: 16000,
      channels: 1,
      chunk: "<base64 encoded audio>"
    }
```

### ะจะฐะณ 5: ะะพะปััะตะฝะธะต ััะฐะฝัะบัะธะฟัะธะน

```
12. ะัะบะตะฝะด ัะฐัะฟะพะทะฝะฐัั ัะตัั (ัะตัะตะท Deepgram/Vosk)
13. ะัะบะตะฝะด ะพัะฟัะฐะฒะปัะตั ะพะฑัะฐัะฝะพ ะฟะพ WebSocket:

    ะงะฐััะธัะฝัะต ัะตะทัะปััะฐัั (ะบะฐะถะดัั ัะตะบัะฝะดั):
    { type: "partial", text: "Hello wor..." }

    ะคะธะฝะฐะปัะฝัะต ัะตะทัะปััะฐัั:
    { type: "final", text: "Hello world!" }
```

### ะจะฐะณ 6: ะะพะบะฐะท ััะฐะฝัะบัะธะฟัะธะน

```
14. Offscreen ะฟะพะปััะฐะตั ัะพะพะฑัะตะฝะธะต ะพั WebSocket
15. Offscreen ะพัะฟัะฐะฒะปัะตั "WS_MESSAGE" ะฒ Service Worker
16. Service Worker ะฟะตัะตััะปะฐะตั ะฒ Content Script:
    chrome.tabs.sendMessage(tabId, { type: "WS_MESSAGE", message: ... })
17. Content Script ะพะฑะฝะพะฒะปัะตั ะฒะธะดะถะตั:
    - ะงะฐััะธัะฝัะน ัะตะบัั โ ัะตััะน ัะฒะตั (ะฟะพะบะฐ ัะฐัะฟะพะทะฝะฐัััั)
    - ะคะธะฝะฐะปัะฝัะน ัะตะบัั โ ัััะฝัะน ัะฒะตั (ะดะพะฑะฐะฒะปัะตััั ะบ ะธััะพัะธะธ)
```

---

## ะะพัะพะบ ะดะฐะฝะฝัั

### ะะพะปะฝะฐั ััะตะผะฐ ะฟะพัะพะบะฐ ะดะฐะฝะฝัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      Chrome Tab (YouTube)                    โ
โ                           ๐ Audio                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โ chrome.tabCapture
                             โ
                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Offscreen Document                        โ
โ  โโโโโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโโ        โ
โ  โ  Audio Element   โ          โ  AudioWorklet    โ        โ
โ  โ   (playback)     โ          โ   (processing)   โ        โ
โ  โโโโโโโโโโฌโโโโโโโโโโ          โโโโโโโโโโฌโโโโโโโโโโ        โ
โ           โ                              โ                   โ
โ           โ                              โ                   โ
โ      ๐ Speakers              PCM chunks (base64)           โ
โ                                          โ                   โ
โ                                          โ                   โ
โ                               โโโโโโโโโโโโโโโโโโโโ          โ
โ                               โ   WebSocket      โ          โ
โ                               โ ws://localhost   โ          โ
โ                               โโโโโโโโโโฌโโโโโโโโโโ          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโ
                                         โ
                    Audio chunks         โ         Transcripts
                         โ               โ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโ
โ                    Backend Server      โ                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ   โ
โ  โ          WebSocket Handler          โ              โ   โ
โ  โ  1. Receive audio chunks                           โ   โ
โ  โ  2. Send to STT provider (Deepgram/Vosk)          โ   โ
โ  โ  3. Get transcripts                                โ   โ
โ  โ  4. Send back: { type: "partial", text: "..." }   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโ
                                         โ
                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Offscreen Document                        โ
โ                  Receives WS_MESSAGE                         โ
โ                          โ                                   โ
โ                  Sends to Service Worker                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Service Worker                            โ
โ           Forwards transcripts to Content Script             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Content Script                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ      โ
โ  โ              LiveScribe Widget                    โ      โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ      โ
โ  โ  โ ๐ Transcript Display                     โ   โ      โ
โ  โ  โ                                            โ   โ      โ
โ  โ  โ "Hello world!"                            โ   โ      โ
โ  โ  โ "How are you?"                            โ   โ      โ
โ  โ  โ "I'm good, thanks..." (partial)           โ   โ      โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะะพัะตะผั ะฝัะถะตะฝ Offscreen Document?

**ะัะพะฑะปะตะผะฐ:** Content Script ะฝะต ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัั chrome.tabCapture ะฝะฐะฟััะผัั.

**ะะตัะตะฝะธะต:** Offscreen Document - ััะพ ัะฟะตัะธะฐะปัะฝัะน ะฝะตะฒะธะดะธะผัะน ะดะพะบัะผะตะฝั, ะบะพัะพััะน:
- ะะผะตะตั ะดะพัััะฟ ะบ Chrome APIs (ะฒะบะปััะฐั tabCapture)
- ะะพะถะตั ัะฐะฑะพัะฐัั ั Web Audio API ะธ WebSocket
- ะะฐะฑะพัะฐะตั ะฒ ัะพะฝะต, ะฝะต ะผะตัะฐั ะฟะพะปัะทะพะฒะฐัะตะปั

### ะะพัะตะผั ะธัะฟะพะปัะทัะตััั Audio Element?

**ะัะพะฑะปะตะผะฐ:** ะะพะณะดะฐ chrome.tabCapture ะทะฐัะฒะฐััะฒะฐะตั ะฐัะดะธะพ, ะพัะธะณะธะฝะฐะปัะฝะพะต ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธะต ะผะพะถะตั ะฟัะพะฟะฐััั.

**ะะตัะตะฝะธะต:** ะั ัะฒะฝะพ ะฒะพัะฟัะพะธะทะฒะพะดะธะผ ะทะฐัะฒะฐัะตะฝะฝัะน ะฟะพัะพะบ ัะตัะตะท `<audio>` ัะปะตะผะตะฝั:
```javascript
const audioElement = new Audio();
audioElement.srcObject = capturedStream;
audioElement.play();
```

ะญัะพ ะณะฐัะฐะฝัะธััะตั, ััะพ ะฟะพะปัะทะพะฒะฐัะตะปั ัะปััะธั ะทะฒัะบ, ะดะฐะถะต ะบะพะณะดะฐ ะผั ะพะฑัะฐะฑะฐััะฒะฐะตะผ ะตะณะพ ะดะปั ััะฐะฝัะบัะธะฑะฐัะธะธ.

### ะะพัะตะผั ะดะฒะฐ ัะพะตะดะธะฝะตะฝะธั ะฝัะถะฝั?

**ะะต ะฟััะฐัั:**
- **AudioWorklet โ ะพะฑัะฐะฑะพัะบะฐ ะฐัะดะธะพ** (ะดะปั ะพัะฟัะฐะฒะบะธ ะฝะฐ ะฑัะบะตะฝะด)
- **Audio Element โ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธะต** (ััะพะฑั ะฟะพะปัะทะพะฒะฐัะตะปั ัะปััะฐะป)

ะะฑะฐ ะธัะฟะพะปัะทััั ะพะดะธะฝ ะธ ัะพั ะถะต `MediaStream`, ะฝะพ ะดะปั ัะฐะทะฝัั ัะตะปะตะน!

### ะคะพัะผะฐั ะฐัะดะธะพ

- **ะัะพะดะฝะพะน ัะพัะผะฐั:** Float32Array (ะพั Chrome)
- **AudioWorklet ะบะพะฝะฒะตััะธััะตั ะฒ:** Int16 PCM, 16000 Hz, Mono
- **ะัะฟัะฐะฒะบะฐ:** Base64 encoded chunks ะฟะพ 8KB
- **ะะฐ ะฑัะบะตะฝะดะต:** ะะตะบะพะดะธััะตััั ะธ ะพัะฟัะฐะฒะปัะตััั ะฒ STT (Deepgram/Vosk)

### ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

**"Receiving end does not exist":**
- ะัะพะธััะพะดะธั, ะบะพะณะดะฐ Offscreen Document ะทะฐะบััะฒะฐะตััั
- Service Worker ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฑัะฐััะฒะฐะตั ัะปะฐะณ `offscreenCreated`
- ะัะธ ัะปะตะดัััะตะผ ััะฐััะต ัะพะทะดะฐัััั ะฝะพะฒัะน Offscreen Document

**WebSocket reconnection:**
- Offscreen ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะฟะพะดะบะปััะฐะตััั ะฟัะธ ัะฐะทััะฒะต ัะพะตะดะธะฝะตะฝะธั
- Content Script ะฟะพะบะฐะทัะฒะฐะตั ััะฐััั ะฟะพะดะบะปััะตะฝะธั

---

## ะัะตะธะผััะตััะฒะฐ ัะตะบััะตะน ะฐััะธัะตะบัััั

โ **ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ:**
- Content Script = UI
- Service Worker = ะะพะพัะดะธะฝะฐัะธั
- Offscreen = ะขัะถัะปะฐั ัะฐะฑะพัะฐ

โ **ะะพะปัะทะพะฒะฐัะตะปั ัะปััะธั ะทะฒัะบ:**
- Audio Element ะฒะพัะฟัะพะธะทะฒะพะดะธั ะทะฐัะฒะฐัะตะฝะฝัะน ะฟะพัะพะบ
- ะะตั "ะทะฐะณะปััะตะฝะธั" ะฐัะดะธะพ ะฒะพ ะฒัะตะผั ะทะฐะฟะธัะธ

โ **ะญััะตะบัะธะฒะฝะพััั:**
- ะขะพะปัะบะพ ะพะดะฝะพ WebSocket ัะพะตะดะธะฝะตะฝะธะต
- ะะธะฝะธะผะฐะปัะฝะฐั ะทะฐะดะตัะถะบะฐ ััะฐะฝัะบัะธะฟัะธะน
- ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะฐัะดะธะพ

โ **ะะฐะดัะถะฝะพััั:**
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ะฟัะธ ะพัะธะฑะบะฐั
- ะัะฐะฒะธะปัะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ ะบะพะผะฟะพะฝะตะฝัะพะฒ
- ะะฑัะฐะฑะพัะบะฐ edge cases (ะทะฐะบัััะธะต ะฒะบะปะฐะดะบะธ, ะฟะพัะตัั ัะพะตะดะธะฝะตะฝะธั ะธ ั.ะด.)

---

## ะะฐะทัะฐะฑะพัะบะฐ ะธ ะพัะปะฐะดะบะฐ

### ะะฐะบ ะพัะปะฐะดะธัั ะบะฐะถะดัะน ะบะพะผะฟะพะฝะตะฝั:

**Content Script:**
```
1. ะัะบัะพะนัะต DevTools ะฝะฐ ัััะฐะฝะธัะต (F12)
2. ะะพ ะฒะบะปะฐะดะบะต Console ัะฒะธะดะธัะต ะปะพะณะธ ะพั content.ts
3. ะะพะถะฝะพ ััะฐะฒะธัั breakpoints ะฒ Sources
```

**Service Worker:**
```
1. ะัะบัะพะนัะต chrome://extensions
2. ะะฐะนะดะธัะต LiveScribe
3. ะะฐะถะผะธัะต "Inspect views: service worker"
4. ะัะบัะพะตััั ะพัะดะตะปัะฝะพะต DevTools ะพะบะฝะพ ะดะปั service worker
```

**Offscreen Document:**
```
1. ะัะบัะพะนัะต chrome://extensions
2. ะะฐะนะดะธัะต LiveScribe
3. ะะฐะถะผะธัะต "Inspect views: offscreen.html"
4. ะัะบัะพะตััั DevTools ะดะปั offscreen ะดะพะบัะผะตะฝัะฐ
```

### ะะพะปะตะทะฝัะต ะปะพะณะธ

- Content Script: `console.log('Recording started via service worker + offscreen')`
- Service Worker: `console.log('Received message:', message.type)`
- Offscreen: `console.log('Audio capture started')`
- Offscreen: `console.log('Received from server:', message)` - ััะฐะฝัะบัะธะฟัะธะธ ะพั ะฑัะบะตะฝะดะฐ

---

## FAQ

**Q: ะะพัะตะผั ะฝะต ะธัะฟะพะปัะทัะตััั ะฟััะผะพะต ะฟะพะดะบะปััะตะฝะธะต Content Script ะบ WebSocket?**

A: Content Script ัะฐะฑะพัะฐะตั ะฒ ะบะพะฝัะตะบััะต ัััะฐะฝะธัั ะธ ะผะพะถะตั ะฑััั ะฟะตัะตะทะฐะณััะถะตะฝ. Offscreen Document ะฑะพะปะตะต ััะฐะฑะธะปะตะฝ ะธ ะธะผะตะตั ะฟะพะปะฝัะน ะดะพัััะฟ ะบ Chrome APIs.

**Q: ะะพัะตะผั ััะฐะฝัะบัะธะฟัะธะธ ะธะดัั ัะตัะตะท Service Worker, ะฐ ะฝะต ะฝะฐะฟััะผัั?**

A: Service Worker - ััะพ ะตะดะธะฝััะฒะตะฝะฝัะน ัะฟะพัะพะฑ ะฝะฐะดัะถะฝะพ ะฟะตัะตะดะฐัั ัะพะพะฑัะตะฝะธั ะผะตะถะดั Offscreen ะธ Content Script. ะะฝ ะดะตะนััะฒัะตั ะบะฐะบ "ะฟะพััะฐะปัะพะฝ".

**Q: ะะพะถะฝะพ ะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ััะพ ัะฐััะธัะตะฝะธะต ะดะปั ะดััะณะธั ัะตะปะตะน?**

A: ะะฐ! ะััะธัะตะบัััะฐ ัะฝะธะฒะตััะฐะปัะฝะฐ ะดะปั ะปัะฑะพะน ะทะฐะดะฐัะธ, ะณะดะต ะฝัะถะฝะพ:
- ะะฐัะฒะฐัะธัั ะฐัะดะธะพ ะธะท ะฒะบะปะฐะดะบะธ
- ะะฑัะฐะฑะพัะฐัั ะตะณะพ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ะะพะบะฐะทะฐัั ัะตะทัะปััะฐัั ะฝะฐ ัััะฐะฝะธัะต

**Q: ะะพัะตะผั ะธัะฟะพะปัะทัะตััั AudioWorklet, ะฐ ะฝะต MediaRecorder?**

A: AudioWorklet ะดะฐัั ะฑะพะปััะต ะบะพะฝััะพะปั ะฝะฐะด ัะพัะผะฐัะพะผ ะฐัะดะธะพ. ะั ะผะพะถะตะผ ะบะพะฝะฒะตััะธัะพะฒะฐัั ะฒ ัะพัะฝัะน ัะพัะผะฐั, ะบะพัะพััะน ะพะถะธะดะฐะตั ะฑัะบะตะฝะด (PCM Int16, 16000 Hz).

---

## ะะฐะปัะฝะตะนัะธะต ัะปัััะตะฝะธั

ะะพะทะผะพะถะฝัะต ะฝะฐะฟัะฐะฒะปะตะฝะธั ัะฐะทะฒะธัะธั:

1. **ะะพะบะฐะปัะฝะพะต ะบััะธัะพะฒะฐะฝะธะต ััะฐะฝัะบัะธะฟัะธะน** (IndexedDB)
2. **ะะพะดะดะตัะถะบะฐ ะฝะตัะบะพะปัะบะธั ัะทัะบะพะฒ** ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
3. **ะญะบัะฟะพัั ััะฐะฝัะบัะธะฟัะธะน** ะฒ ัะฐะทะฝัะต ัะพัะผะฐัั (TXT, SRT, JSON)
4. **Speaker diarization** (ะพะฟัะตะดะตะปะตะฝะธะต, ะบัะพ ะณะพะฒะพัะธั)
5. **Offline ัะตะถะธะผ** ั ะปะพะบะฐะปัะฝะพะน ะผะพะดะตะปัั STT

---

ะกะพะทะดะฐะฝะพ ั ะฟะพะผะพััั Claude Code ๐ค
